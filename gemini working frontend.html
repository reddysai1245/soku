<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compound Interest Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        /* Smooth transitions for sections */
        .section {
            opacity: 1;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            transform: translateY(0);
        }
        .section.hidden {
            opacity: 0;
            transform: translateY(20px);
            position: absolute; /* To prevent layout shift when hidden */
            pointer-events: none; /* Disable interactions when hidden */
            width: 100%; /* Maintain width when hidden */
        }
        /* Smooth transitions for input focus */
        input[type="text"],
        input[type="number"],
        input[type="date"] {
            transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus {
            outline: none;
            border-color: var(--focus-ring-color); /* Dynamically set by JS */
            box-shadow: 0 0 0 3px var(--focus-ring-shadow-color); /* Dynamically set by JS */
        }
        /* Modal styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 400px;
            text-align: center;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
        }
        .modal.show .modal-content {
            transform: translateY(0);
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 relative">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Compound Interest Manager</h1>
            <p class="text-gray-600">Track your lending and borrowing with automated compound interest calculations</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex justify-center mb-8">
            <div class="bg-white rounded-lg shadow-md p-1 flex">
                <button onclick="showSection('receivables')" id="receivables-tab" class="px-6 py-3 rounded-md font-medium transition-all duration-200 bg-blue-600 text-white">
                    Money to Receive
                </button>
                <button onclick="showSection('payables')" id="payables-tab" class="px-6 py-3 rounded-md font-medium transition-all duration-200 text-gray-600 hover:text-blue-600">
                    Money to Pay
                </button>
                <button onclick="showSection('dashboard')" id="dashboard-tab" class="px-6 py-3 rounded-md font-medium transition-all duration-200 text-gray-600 hover:text-blue-600">
                    Dashboard
                </button>
            </div>
        </div>

        <!-- Money to Receive Section -->
        <div id="receivables-section" class="section">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-semibold text-green-700 mb-4 flex items-center">
                    <span class="bg-green-100 p-2 rounded-lg mr-3">üí∞</span>
                    Money to Receive
                </h2>
                
                <!-- Add New Entry Form -->
                <div class="bg-green-50 rounded-lg p-4 mb-6">
                    <h3 class="font-medium text-green-800 mb-3">Add New Entry</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <input type="text" id="receivable-name" placeholder="Person/Entity Name" class="px-3 py-2 border border-green-300 rounded-md focus:ring-green-500" style="--focus-ring-color: #34D399; --focus-ring-shadow-color: rgba(52, 211, 153, 0.5);">
                        <input type="number" id="receivable-principal" placeholder="Principal Amount (‚Çπ)" class="px-3 py-2 border border-green-300 rounded-md focus:ring-green-500" style="--focus-ring-color: #34D399; --focus-ring-shadow-color: rgba(52, 211, 153, 0.5);">
                        <input type="number" id="receivable-rate" placeholder="Monthly Rate (e.g., 1.25)" step="0.01" class="px-3 py-2 border border-green-300 rounded-md focus:ring-green-500" style="--focus-ring-color: #34D399; --focus-ring-shadow-color: rgba(52, 211, 153, 0.5);">
                    </div>
                    
                    <!-- Duration Selection -->
                    <div class="mb-4">
                        <label class="block text-green-800 font-medium mb-2">Duration Method:</label>
                        <div class="flex gap-4 mb-3">
                            <label class="flex items-center">
                                <input type="radio" name="receivable-duration-type" value="date" checked onchange="toggleReceivableDuration()" class="mr-2">
                                <span class="text-green-700">By Date Range</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="receivable-duration-type" value="duration" onchange="toggleReceivableDuration()" class="mr-2">
                                <span class="text-green-700">By Duration</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="receivable-duration-type" value="fromstart" onchange="toggleReceivableDuration()" class="mr-2">
                                <span class="text-green-700">From Start to Today</span>
                            </label>
                        </div>
                        
                        <!-- Date Input -->
                        <div id="receivable-date-input" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="date" id="receivable-start-date" placeholder="Start Date" class="px-3 py-2 border border-green-300 rounded-md focus:ring-green-500" style="--focus-ring-color: #34D399; --focus-ring-shadow-color: rgba(52, 211, 153, 0.5);">
                            <input type="date" id="receivable-end-date" placeholder="End Date" class="px-3 py-2 border border-green-300 rounded-md focus:ring-green-500" style="--focus-ring-color: #34D399; --focus-ring-shadow-color: rgba(52, 211, 153, 0.5);">
                        </div>
                        
                        <!-- Duration Input -->
                        <div id="receivable-duration-input" class="hidden grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="number" id="receivable-years" placeholder="Years" min="0" class="px-3 py-2 border border-green-300 rounded-md focus:ring-green-500" style="--focus-ring-color: #34D399; --focus-ring-shadow-color: rgba(52, 211, 153, 0.5);">
                            <input type="number" id="receivable-months" placeholder="Months" min="0" max="11" class="px-3 py-2 border border-green-300 rounded-md focus:ring-green-500" style="--focus-ring-color: #34D399; --focus-ring-shadow-color: rgba(52, 211, 153, 0.5);">
                            <input type="number" id="receivable-days" placeholder="Days" min="0" max="30" class="px-3 py-2 border border-green-300 rounded-md focus:ring-green-500" style="--focus-ring-color: #34D399; --focus-ring-shadow-color: rgba(52, 211, 153, 0.5);">
                        </div>
                        
                        <!-- From Start Input -->
                        <div id="receivable-fromstart-input" class="hidden">
                            <input type="date" id="receivable-from-start-date" placeholder="Start Date" class="px-3 py-2 border border-green-300 rounded-md focus:ring-green-500" style="--focus-ring-color: #34D399; --focus-ring-shadow-color: rgba(52, 211, 153, 0.5);">
                        </div>
                    </div>
                    
                    <button onclick="addReceivable()" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors">
                        Add Entry
                    </button>
                </div>

                <!-- Receivables Table -->
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-green-100">
                                <th class="border border-green-300 px-4 py-3 text-left font-semibold text-green-800">Name</th>
                                <th class="border border-green-300 px-4 py-3 text-right font-semibold text-green-800">Principal (‚Çπ)</th>
                                <th class="border border-green-300 px-4 py-3 text-center font-semibold text-green-800">Given Rate (%)</th>
                                <th class="border border-green-300 px-4 py-3 text-center font-semibold text-green-800">Start Date</th>
                                <th class="border border-green-300 px-4 py-3 text-center font-semibold text-green-800">End Date</th>
                                <th class="border border-green-300 px-4 py-3 text-center font-semibold text-green-800">Duration</th>
                                <th class="border border-green-300 px-4 py-3 text-right font-semibold text-green-800">Interest (‚Çπ)</th>
                                <th class="border border-green-300 px-4 py-3 text-right font-semibold text-green-800">Total (‚Çπ)</th>
                                <th class="border border-green-300 px-4 py-3 text-center font-semibold text-green-800">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="receivables-table">
                            <!-- Dynamic content will be added here -->
                        </tbody>
                        <tfoot>
                            <tr class="bg-green-200 font-bold">
                                <td class="border border-green-300 px-4 py-3 text-green-800">TOTAL</td>
                                <td class="border border-green-300 px-4 py-3 text-right text-green-800" id="receivables-principal-total">‚Çπ0</td>
                                <td class="border border-green-300 px-4 py-3"></td>
                                <td class="border border-green-300 px-4 py-3"></td>
                                <td class="border border-green-300 px-4 py-3"></td>
                                <td class="border border-green-300 px-4 py-3"></td>
                                <td class="border border-green-300 px-4 py-3 text-right text-green-800" id="receivables-interest-till-date-total">‚Çπ0</td>
                                <td class="border border-green-300 px-4 py-3 text-right text-green-800" id="receivables-total-total">‚Çπ0</td>
                                <td class="border border-green-300 px-4 py-3"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <!-- Money to Pay Section -->
        <div id="payables-section" class="section hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-semibold text-red-700 mb-4 flex items-center">
                    <span class="bg-red-100 p-2 rounded-lg mr-3">üí∏</span>
                    Money to Pay
                </h2>
                
                <!-- Add New Entry Form -->
                <div class="bg-red-50 rounded-lg p-4 mb-6">
                    <h3 class="font-medium text-red-800 mb-3">Add New Entry</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <input type="text" id="payable-name" placeholder="Person/Entity Name" class="px-3 py-2 border border-red-300 rounded-md focus:ring-red-500" style="--focus-ring-color: #EF4444; --focus-ring-shadow-color: rgba(239, 68, 68, 0.5);">
                        <input type="number" id="payable-principal" placeholder="Principal Amount (‚Çπ)" class="px-3 py-2 border border-red-300 rounded-md focus:ring-red-500" style="--focus-ring-color: #EF4444; --focus-ring-shadow-color: rgba(239, 68, 68, 0.5);">
                        <input type="number" id="payable-rate" placeholder="Monthly Rate (e.g., 1.25)" step="0.01" class="px-3 py-2 border border-red-300 rounded-md focus:ring-red-500" style="--focus-ring-color: #EF4444; --focus-ring-shadow-color: rgba(239, 68, 68, 0.5);">
                    </div>
                    
                    <!-- Duration Selection -->
                    <div class="mb-4">
                        <label class="block text-red-800 font-medium mb-2">Duration Method:</label>
                        <div class="flex gap-4 mb-3">
                            <label class="flex items-center">
                                <input type="radio" name="payable-duration-type" value="date" checked onchange="togglePayableDuration()" class="mr-2">
                                <span class="text-red-700">By Date Range</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="payable-duration-type" value="duration" onchange="togglePayableDuration()" class="mr-2">
                                <span class="text-red-700">By Duration</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="payable-duration-type" value="fromstart" onchange="togglePayableDuration()" class="mr-2">
                                <span class="text-red-700">From Start to Today</span>
                            </label>
                        </div>
                        
                        <!-- Date Input -->
                        <div id="payable-date-input" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="date" id="payable-start-date" placeholder="Start Date" class="px-3 py-2 border border-red-300 rounded-md focus:ring-red-500" style="--focus-ring-color: #EF4444; --focus-ring-shadow-color: rgba(239, 68, 68, 0.5);">
                            <input type="date" id="payable-end-date" placeholder="End Date" class="px-3 py-2 border border-red-300 rounded-md focus:ring-red-500" style="--focus-ring-color: #EF4444; --focus-ring-shadow-color: rgba(239, 68, 68, 0.5);">
                        </div>
                        
                        <!-- Duration Input -->
                        <div id="payable-duration-input" class="hidden grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="number" id="payable-years" placeholder="Years" min="0" class="px-3 py-2 border border-red-300 rounded-md focus:ring-red-500" style="--focus-ring-color: #EF4444; --focus-ring-shadow-color: rgba(239, 68, 68, 0.5);">
                            <input type="number" id="payable-months" placeholder="Months" min="0" max="11" class="px-3 py-2 border border-red-300 rounded-md focus:ring-red-500" style="--focus-ring-color: #EF4444; --focus-ring-shadow-color: rgba(239, 68, 68, 0.5);">
                            <input type="number" id="payable-days" placeholder="Days" min="0" max="30" class="px-3 py-2 border border-red-300 rounded-md focus:ring-red-500" style="--focus-ring-color: #EF4444; --focus-ring-shadow-color: rgba(239, 68, 68, 0.5);">
                        </div>
                        
                        <!-- From Start Input -->
                        <div id="payable-fromstart-input" class="hidden">
                            <input type="date" id="payable-from-start-date" placeholder="Start Date" class="px-3 py-2 border border-red-300 rounded-md focus:ring-red-500" style="--focus-ring-color: #EF4444; --focus-ring-shadow-color: rgba(239, 68, 68, 0.5);">
                        </div>
                    </div>
                    
                    <button onclick="addPayable()" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors">
                        Add Entry
                    </button>
                </div>

                <!-- Payables Table -->
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-red-100">
                                <th class="border border-red-300 px-4 py-3 text-left font-semibold text-red-800">Name</th>
                                <th class="border border-red-300 px-4 py-3 text-right font-semibold text-red-800">Principal (‚Çπ)</th>
                                <th class="border border-red-300 px-4 py-3 text-center font-semibold text-red-800">Given Rate (%)</th>
                                <th class="border border-red-300 px-4 py-3 text-center font-semibold text-red-800">Start Date</th>
                                <th class="border border-red-300 px-4 py-3 text-center font-semibold text-red-800">End Date</th>
                                <th class="border border-red-300 px-4 py-3 text-center font-semibold text-red-800">Duration</th>
                                <th class="border border-red-300 px-4 py-3 text-right font-semibold text-red-800">Interest (‚Çπ)</th>
                                <th class="border border-red-300 px-4 py-3 text-right font-semibold text-red-800">Total (‚Çπ)</th>
                                <th class="border border-red-300 px-4 py-3 text-center font-semibold text-red-800">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="payables-table">
                            <!-- Dynamic content will be added here -->
                        </tbody>
                        <tfoot>
                            <tr class="bg-red-200 font-bold">
                                <td class="border border-red-300 px-4 py-3 text-red-800">TOTAL</td>
                                <td class="border border-red-300 px-4 py-3 text-right text-red-800" id="payables-principal-total">‚Çπ0</td>
                                <td class="border border-red-300 px-4 py-3"></td>
                                <td class="border border-red-300 px-4 py-3"></td>
                                <td class="border border-red-300 px-4 py-3"></td>
                                <td class="border border-red-300 px-4 py-3"></td>
                                <td class="border border-red-300 px-4 py-3 text-right text-red-800" id="payables-interest-till-date-total">‚Çπ0</td>
                                <td class="border border-red-300 px-4 py-3 text-right text-red-800" id="payables-total-total">‚Çπ0</td>
                                <td class="border border-red-300 px-4 py-3"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Summary Cards -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="bg-green-100 p-2 rounded-lg mr-3">üìà</span>
                        Money to Receive Summary
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Principal:</span>
                            <span class="font-semibold text-green-600" id="dashboard-receivables-principal">‚Çπ0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Interest:</span>
                            <span class="font-semibold text-green-600" id="dashboard-receivables-interest">‚Çπ0</span>
                        </div>
                        <div class="flex justify-between border-t pt-2">
                            <span class="text-gray-800 font-medium">Total Amount:</span>
                            <span class="font-bold text-green-700" id="dashboard-receivables-total">‚Çπ0</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="bg-red-100 p-2 rounded-lg mr-3">üìâ</span>
                        Money to Pay Summary
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Principal:</span>
                            <span class="font-semibold text-red-600" id="dashboard-payables-principal">‚Çπ0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Interest:</span>
                            <span class="font-semibold text-red-600" id="dashboard-payables-interest">‚Çπ0</span>
                        </div>
                        <div class="flex justify-between border-t pt-2">
                            <span class="text-gray-800 font-medium">Total Amount:</span>
                            <span class="font-bold text-red-700" id="dashboard-payables-total">‚Çπ0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Net Position -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <span class="bg-blue-100 p-2 rounded-lg mr-3">‚öñÔ∏è</span>
                    Net Financial Position
                </h3>
                <div class="text-center">
                    <div class="text-3xl font-bold mb-2" id="net-position">‚Çπ0</div>
                    <div class="text-gray-600" id="net-position-text">Balanced Position</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Alert Modal -->
    <div id="custom-alert-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <p id="modal-message" class="text-lg font-medium text-gray-800 mb-4"></p>
            <button onclick="closeModal()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">OK</button>
        </div>
    </div>

    <script>
        // Data storage
        let receivables = [];
        let payables = [];

        // Function to show custom modal
        function showModal(message) {
            const modal = document.getElementById('custom-alert-modal');
            document.getElementById('modal-message').textContent = message;
            modal.classList.add('show');
        }

        // Function to close custom modal
        function closeModal() {
            const modal = document.getElementById('custom-alert-modal');
            modal.classList.remove('show');
        }

        // Show/hide sections
        function showSection(section) {
            // Get all sections
            const allSections = document.querySelectorAll('.section');
            
            // Hide all sections with animation
            allSections.forEach(s => {
                s.classList.add('hidden');
            });

            // Remove active class from all tabs
            document.querySelectorAll('[id$="-tab"]').forEach(tab => {
                tab.classList.remove('bg-blue-600', 'text-white');
                tab.classList.add('text-gray-600', 'hover:text-blue-600');
            });
            
            // Show selected section after a small delay for smooth transition
            setTimeout(() => {
                const selectedSection = document.getElementById(section + '-section');
                selectedSection.classList.remove('hidden');
                // Activate selected tab
                const activeTab = document.getElementById(section + '-tab');
                activeTab.classList.add('bg-blue-600', 'text-white');
                activeTab.classList.remove('text-gray-600', 'hover:text-blue-600');

                if (section === 'dashboard') {
                    updateDashboard();
                }
            }, 100); // Small delay for fade-out effect before fade-in
        }

        // Helper function to calculate a past date from an end date and duration
        function calculateStartDateFromDuration(endDate, years, months, days) {
            const end = new Date(endDate);
            let start = new Date(end);

            // Subtract years, months, and days
            start.setFullYear(start.getFullYear() - years);
            start.setMonth(start.getMonth() - months);
            start.setDate(start.getDate() - days);

            return start.toISOString().split('T')[0];
        }

        // Toggle duration input methods for receivables
        function toggleReceivableDuration() {
            const durationType = document.querySelector('input[name="receivable-duration-type"]:checked').value;
            const dateInput = document.getElementById('receivable-date-input');
            const durationInput = document.getElementById('receivable-duration-input');
            const fromStartInput = document.getElementById('receivable-fromstart-input');
            
            // Clear all duration-related input fields
            document.getElementById('receivable-start-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('receivable-end-date').value = '';
            document.getElementById('receivable-years').value = '';
            document.getElementById('receivable-months').value = '';
            document.getElementById('receivable-days').value = '';
            document.getElementById('receivable-from-start-date').value = '';

            // Hide all inputs first
            dateInput.classList.add('hidden');
            durationInput.classList.add('hidden');
            fromStartInput.classList.add('hidden');
            
            // Show the selected input
            if (durationType === 'date') {
                dateInput.classList.remove('hidden');
            } else if (durationType === 'duration') {
                durationInput.classList.remove('hidden');
            } else if (durationType === 'fromstart') {
                fromStartInput.classList.remove('hidden');
            }
        }

        // Toggle duration input methods for payables
        function togglePayableDuration() {
            const durationType = document.querySelector('input[name="payable-duration-type"]:checked').value;
            const dateInput = document.getElementById('payable-date-input');
            const durationInput = document.getElementById('payable-duration-input');
            const fromStartInput = document.getElementById('payable-fromstart-input');

            // Clear all duration-related input fields
            document.getElementById('payable-start-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('payable-end-date').value = '';
            document.getElementById('payable-years').value = '';
            document.getElementById('payable-months').value = '';
            document.getElementById('payable-days').value = '';
            document.getElementById('payable-from-start-date').value = '';
            
            // Hide all inputs first
            dateInput.classList.add('hidden');
            durationInput.classList.add('hidden');
            fromStartInput.classList.add('hidden');
            
            // Show the selected input
            if (durationType === 'date') {
                dateInput.classList.remove('hidden');
            } else if (durationType === 'duration') {
                durationInput.classList.remove('hidden');
            } else if (durationType === 'fromstart') {
                fromStartInput.classList.remove('hidden');
            }
        }

        // Helper function to format duration display
        function formatDuration(startDate, endDate = null, years = 0, months = 0, days = 0) {
            if (endDate) {
                // Calculate duration from dates
                const start = new Date(startDate);
                const end = new Date(endDate);
                const startYear = start.getFullYear();
                const startMonth = start.getMonth();
                const startDay = start.getDate();
                const endYear = end.getFullYear();
                const endMonth = end.getMonth();
                const endDay = end.getDate();
                
                let yearsDiff = endYear - startYear;
                let monthsDiff = endMonth - startMonth;
                let daysDiff = endDay - startDay;
                
                if (daysDiff < 0) {
                    monthsDiff--;
                    daysDiff += 30;
                }
                
                if (monthsDiff < 0) {
                    yearsDiff--;
                    monthsDiff += 12;
                }
                
                let parts = [];
                if (yearsDiff > 0) parts.push(`${yearsDiff}Y`);
                if (monthsDiff > 0) parts.push(`${monthsDiff}M`);
                if (daysDiff > 0) parts.push(`${daysDiff}D`);
                
                return parts.length > 0 ? parts.join(' ') : '0D';
            } else {
                // Format from duration values
                let parts = [];
                if (years > 0) parts.push(`${years}Y`);
                if (months > 0) parts.push(`${months}M`);
                if (days > 0) parts.push(`${days}D`);
                
                return parts.length > 0 ? parts.join(' ') : '0D';
            }
        }

        // Calculate compound interest with flexible duration input
        // Rate is monthly: 1.25 means ‚Çπ1.25 per ‚Çπ100 per month (fixed rate per 100)
        // ‚Çπ100,000 at 1.25 rate = ‚Çπ1,250 interest per month (100,000/100 * 1.25)
        // Compounds annually: Interest is added to principal at year end
        // Using exactly 360 days per year and 30 days per month
        function calculateCompoundInterest(principal, monthlyRate, startDate, endDate = null, years = 0, months = 0, days = 0) {
            const start = new Date(startDate);
            let totalDays;
            
            if (endDate) {
                // For date range, use exact 360-day system calculation
                const end = new Date(endDate);
                const startYear = start.getFullYear();
                const startMonth = start.getMonth();
                const startDay = start.getDate();
                const endYear = end.getFullYear();
                const endMonth = end.getMonth();
                const endDay = end.getDate();
                
                // Calculate years, months, and days in 360-day system
                let yearsDiff = endYear - startYear;
                let monthsDiff = endMonth - startMonth;
                let daysDiff = endDay - startDay;
                
                // Adjust for negative days
                if (daysDiff < 0) {
                    monthsDiff--;
                    daysDiff += 30; // Always use 30 days per month
                }
                
                if (monthsDiff < 0) {
                    yearsDiff--;
                    monthsDiff += 12;
                }
                
                // Convert to total days using 360-day system
                totalDays = (yearsDiff * 360) + (monthsDiff * 30) + daysDiff;
            } else {
                // Calculate from duration using exact 360-day year system
                totalDays = (years * 360) + (months * 30) + days;
            }
            
            if (totalDays <= 0) return { interest: (principal / 100) * monthlyRate, interestTillDate: 0, total: principal };
            
            // Using exact 360-day year system: 1 year = 360 days = 12 months of 30 days each
            const completeYears = Math.floor(totalDays / 360);
            const remainingDays = totalDays % 360;
            const remainingMonths = Math.floor(remainingDays / 30);
            const finalDays = remainingDays % 30;
            
            let currentPrincipal = principal;
            let totalInterest = 0;
            
            // Calculate interest for complete years (compound annually)
            for (let year = 0; year < completeYears; year++) {
                // Calculate monthly interest: (currentPrincipal / 100) * rate
                const monthlyInterestAmount = (currentPrincipal / 100) * monthlyRate;
                // Simple interest for exactly 12 months within the year
                const yearlyInterest = monthlyInterestAmount * 12;
                totalInterest += yearlyInterest;
                // Compound: Add interest to principal for next year
                currentPrincipal += yearlyInterest;
            }
            
            // Calculate interest for remaining months (based on current principal after complete years)
            if (remainingMonths > 0) {
                const monthlyInterestAmount = (currentPrincipal / 100) * monthlyRate;
                const remainingMonthsInterest = monthlyInterestAmount * remainingMonths;
                totalInterest += remainingMonthsInterest;
            }
            
            // Calculate interest for remaining days (proportional to monthly rate based on current principal)
            if (finalDays > 0) {
                const monthlyInterestAmount = (currentPrincipal / 100) * monthlyRate;
                const dailyInterest = monthlyInterestAmount / 30;
                totalInterest += dailyInterest * finalDays;
            }
            
            const finalAmount = principal + totalInterest;
            
            return {
                interest: (principal / 100) * monthlyRate, // Monthly interest amount for original principal (for display)
                interestTillDate: totalInterest,
                total: finalAmount
            };
        }

        // Add receivable entry
        function addReceivable() {
            const name = document.getElementById('receivable-name').value.trim();
            const principal = parseFloat(document.getElementById('receivable-principal').value);
            const rate = parseFloat(document.getElementById('receivable-rate').value);
            const durationType = document.querySelector('input[name="receivable-duration-type"]:checked').value;

            if (!name) {
                showModal('Please enter a person/entity name.');
                return;
            }
            if (isNaN(principal) || principal <= 0) {
                showModal('Please enter a valid principal amount (must be a positive number).');
                return;
            }
            if (isNaN(rate) || rate <= 0) {
                showModal('Please enter a valid monthly rate (must be a positive number).');
                return;
            }

            let entry = {
                id: Date.now(),
                name,
                principal,
                rate,
                durationType
            };

            if (durationType === 'date') {
                const startDate = document.getElementById('receivable-start-date').value;
                const endDate = document.getElementById('receivable-end-date').value;
                
                if (!startDate || !endDate) {
                    showModal('Please fill both start and end dates.');
                    return;
                }
                if (new Date(startDate) > new Date(endDate)) {
                    showModal('Start date cannot be after end date.');
                    return;
                }
                
                entry.startDate = startDate;
                entry.endDate = endDate;
            } else if (durationType === 'duration') {
                const years = parseInt(document.getElementById('receivable-years').value) || 0;
                const months = parseInt(document.getElementById('receivable-months').value) || 0;
                const days = parseInt(document.getElementById('receivable-days').value) || 0;
                
                if (years === 0 && months === 0 && days === 0) {
                    showModal('Please fill at least one duration field (years, months, or days).');
                    return;
                }
                
                entry.endDate = new Date().toISOString().split('T')[0]; // Set endDate to today's date
                entry.startDate = calculateStartDateFromDuration(entry.endDate, years, months, days); // Calculate startDate
                entry.years = years; // Store for formatDuration display
                entry.months = months; // Store for formatDuration display
                entry.days = days; // Store for formatDuration display
            } else if (durationType === 'fromstart') {
                const startDate = document.getElementById('receivable-from-start-date').value;
                
                if (!startDate) {
                    showModal('Please fill the start date.');
                    return;
                }
                
                entry.startDate = startDate;
                entry.endDate = new Date().toISOString().split('T')[0]; // Use today's date as end date
                if (new Date(startDate) > new Date(entry.endDate)) {
                    showModal('Start date cannot be in the future for "From Start to Today" option.');
                    return;
                }
            }

            receivables.push(entry);
            updateReceivablesTable();
            
            // Clear form and reset to default duration type
            document.getElementById('receivable-name').value = '';
            document.getElementById('receivable-principal').value = '';
            document.getElementById('receivable-rate').value = '';
            document.querySelector('input[name="receivable-duration-type"][value="date"]').checked = true;
            toggleReceivableDuration(); // Reset duration inputs
        }

        // Add payable entry
        function addPayable() {
            const name = document.getElementById('payable-name').value.trim();
            const principal = parseFloat(document.getElementById('payable-principal').value);
            const rate = parseFloat(document.getElementById('payable-rate').value);
            const durationType = document.querySelector('input[name="payable-duration-type"]:checked').value;

            if (!name) {
                showModal('Please enter a person/entity name.');
                return;
            }
            if (isNaN(principal) || principal <= 0) {
                showModal('Please enter a valid principal amount (must be a positive number).');
                return;
            }
            if (isNaN(rate) || rate <= 0) {
                showModal('Please enter a valid monthly rate (must be a positive number).');
                return;
            }

            let entry = {
                id: Date.now(),
                name,
                principal,
                rate,
                durationType
            };

            if (durationType === 'date') {
                const startDate = document.getElementById('payable-start-date').value;
                const endDate = document.getElementById('payable-end-date').value;
                
                if (!startDate || !endDate) {
                    showModal('Please fill both start and end dates.');
                    return;
                }
                if (new Date(startDate) > new Date(endDate)) {
                    showModal('Start date cannot be after end date.');
                    return;
                }
                
                entry.startDate = startDate;
                entry.endDate = endDate;
            } else if (durationType === 'duration') {
                const years = parseInt(document.getElementById('payable-years').value) || 0;
                const months = parseInt(document.getElementById('payable-months').value) || 0;
                const days = parseInt(document.getElementById('payable-days').value) || 0;
                
                if (years === 0 && months === 0 && days === 0) {
                    showModal('Please fill at least one duration field (years, months, or days).');
                    return;
                }
                
                entry.endDate = new Date().toISOString().split('T')[0]; // Set endDate to today's date
                entry.startDate = calculateStartDateFromDuration(entry.endDate, years, months, days); // Calculate startDate
                entry.years = years; // Store for formatDuration display
                entry.months = months; // Store for formatDuration display
                entry.days = days; // Store for formatDuration display
            } else if (durationType === 'fromstart') {
                const startDate = document.getElementById('payable-from-start-date').value;
                
                if (!startDate) {
                    showModal('Please fill the start date.');
                    return;
                }
                
                entry.startDate = startDate;
                entry.endDate = new Date().toISOString().split('T')[0]; // Use today's date as end date
                if (new Date(startDate) > new Date(entry.endDate)) {
                    showModal('Start date cannot be in the future for "From Start to Today" option.');
                    return;
                }
            }

            payables.push(entry);
            updatePayablesTable();
            
            // Clear form and reset to default duration type
            document.getElementById('payable-name').value = '';
            document.getElementById('payable-principal').value = '';
            document.getElementById('payable-rate').value = '';
            document.querySelector('input[name="payable-duration-type"][value="date"]').checked = true;
            togglePayableDuration(); // Reset duration inputs
        }

        // Update receivables table
        function updateReceivablesTable() {
            const tbody = document.getElementById('receivables-table');
            tbody.innerHTML = '';

            let totalPrincipal = 0;
            let totalInterest = 0;
            let totalInterestTillDate = 0;
            let totalAmount = 0;

            receivables.forEach(entry => {
                let calc;
                let displayStartDate = '';
                let displayEndDate = '';
                
                if (entry.durationType === 'date' || entry.durationType === 'fromstart') {
                    calc = calculateCompoundInterest(entry.principal, entry.rate, entry.startDate, entry.endDate);
                    displayStartDate = new Date(entry.startDate).toLocaleDateString('en-IN');
                    displayEndDate = new Date(entry.endDate).toLocaleDateString('en-IN');
                } else { // durationType === 'duration'
                    // For calculation, use the stored startDate and endDate
                    calc = calculateCompoundInterest(entry.principal, entry.rate, entry.startDate, entry.endDate);
                    displayStartDate = new Date(entry.startDate).toLocaleDateString('en-IN'); // Now display the calculated past date
                    displayEndDate = new Date(entry.endDate).toLocaleDateString('en-IN'); // This will be today's date
                }
                
                totalPrincipal += entry.principal;
                totalInterest += calc.interest;
                totalInterestTillDate += calc.interestTillDate;
                totalAmount += calc.total;

                // Format duration
                let durationFormatted = '';
                if (entry.durationType === 'date' || entry.durationType === 'fromstart') {
                    durationFormatted = formatDuration(entry.startDate, entry.endDate);
                } else { // durationType === 'duration'
                    durationFormatted = formatDuration(entry.startDate, null, entry.years, entry.months, entry.days);
                }

                const row = document.createElement('tr');
                row.className = 'hover:bg-green-50';
                row.innerHTML = `
                    <td class="border border-green-300 px-4 py-3">${entry.name}</td>
                    <td class="border border-green-300 px-4 py-3 text-right">‚Çπ${entry.principal.toLocaleString('en-IN', {maximumFractionDigits: 2})}</td>
                    <td class="border border-green-300 px-4 py-3 text-center">${entry.rate}%</td>
                    <td class="border border-green-300 px-4 py-3 text-center">${displayStartDate}</td>
                    <td class="border border-green-300 px-4 py-3 text-center">${displayEndDate}</td>
                    <td class="border border-green-300 px-4 py-3 text-center">${durationFormatted}</td>
                    <td class="border border-green-300 px-4 py-3 text-right">‚Çπ${calc.interestTillDate.toLocaleString('en-IN', {maximumFractionDigits: 2})}</td>
                    <td class="border border-green-300 px-4 py-3 text-right font-semibold">‚Çπ${calc.total.toLocaleString('en-IN', {maximumFractionDigits: 2})}</td>
                    <td class="border border-green-300 px-4 py-3 text-center">
                        <button onclick="deleteReceivable(${entry.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm hover:bg-red-600">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Update totals
            document.getElementById('receivables-principal-total').textContent = `‚Çπ${totalPrincipal.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;
            document.getElementById('receivables-interest-till-date-total').textContent = `‚Çπ${totalInterestTillDate.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;
            document.getElementById('receivables-total-total').textContent = `‚Çπ${totalAmount.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;
        }

        // Update payables table
        function updatePayablesTable() {
            const tbody = document.getElementById('payables-table');
            tbody.innerHTML = '';

            let totalPrincipal = 0;
            let totalInterest = 0;
            let totalInterestTillDate = 0;
            let totalAmount = 0;

            payables.forEach(entry => {
                let calc;
                let displayStartDate = '';
                let displayEndDate = '';

                if (entry.durationType === 'date' || entry.durationType === 'fromstart') {
                    calc = calculateCompoundInterest(entry.principal, entry.rate, entry.startDate, entry.endDate);
                    displayStartDate = new Date(entry.startDate).toLocaleDateString('en-IN');
                    displayEndDate = new Date(entry.endDate).toLocaleDateString('en-IN');
                } else { // durationType === 'duration'
                    // For calculation, use the stored startDate and endDate
                    calc = calculateCompoundInterest(entry.principal, entry.rate, entry.startDate, entry.endDate);
                    displayStartDate = new Date(entry.startDate).toLocaleDateString('en-IN'); // Now display the calculated past date
                    displayEndDate = new Date(entry.endDate).toLocaleDateString('en-IN'); // This will be today's date
                }
                
                totalPrincipal += entry.principal;
                totalInterest += calc.interest;
                totalInterestTillDate += calc.interestTillDate;
                totalAmount += calc.total;

                // Format duration
                let durationFormatted = '';
                if (entry.durationType === 'date' || entry.durationType === 'fromstart') {
                    durationFormatted = formatDuration(entry.startDate, entry.endDate);
                } else { // durationType === 'duration'
                    durationFormatted = formatDuration(entry.startDate, null, entry.years, entry.months, entry.days);
                }

                const row = document.createElement('tr');
                row.className = 'hover:bg-red-50';
                row.innerHTML = `
                    <td class="border border-red-300 px-4 py-3">${entry.name}</td>
                    <td class="border border-red-300 px-4 py-3 text-right">‚Çπ${entry.principal.toLocaleString('en-IN', {maximumFractionDigits: 2})}</td>
                    <td class="border border-red-300 px-4 py-3 text-center">${entry.rate}%</td>
                    <td class="border border-red-300 px-4 py-3 text-center">${displayStartDate}</td>
                    <td class="border border-red-300 px-4 py-3 text-center">${displayEndDate}</td>
                    <td class="border border-red-300 px-4 py-3 text-center">${durationFormatted}</td>
                    <td class="border border-red-300 px-4 py-3 text-right">‚Çπ${calc.interestTillDate.toLocaleString('en-IN', {maximumFractionDigits: 2})}</td>
                    <td class="border border-red-300 px-4 py-3 text-right font-semibold">‚Çπ${calc.total.toLocaleString('en-IN', {maximumFractionDigits: 2})}</td>
                    <td class="border border-red-300 px-4 py-3 text-center">
                        <button onclick="deletePayable(${entry.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm hover:bg-red-600">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Update totals
            document.getElementById('payables-principal-total').textContent = `‚Çπ${totalPrincipal.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;
            document.getElementById('payables-interest-till-date-total').textContent = `‚Çπ${totalInterestTillDate.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;
            document.getElementById('payables-total-total').textContent = `‚Çπ${totalAmount.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;
        }

        // Delete functions
        function deleteReceivable(id) {
            receivables = receivables.filter(entry => entry.id !== id);
            updateReceivablesTable();
        }

        function deletePayable(id) {
            payables = payables.filter(entry => entry.id !== id);
            updatePayablesTable();
        }

        // Update dashboard
        function updateDashboard() {
            // Calculate receivables totals
            let receivablesTotalPrincipal = 0;
            let receivablesTotalInterest = 0;
            let receivablesTotalAmount = 0;

            receivables.forEach(entry => {
                let calc;
                if (entry.durationType === 'date' || entry.durationType === 'fromstart') {
                    calc = calculateCompoundInterest(entry.principal, entry.rate, entry.startDate, entry.endDate);
                } else {
                    calc = calculateCompoundInterest(entry.principal, entry.rate, entry.startDate, null, entry.years, entry.months, entry.days);
                }
                receivablesTotalPrincipal += entry.principal;
                receivablesTotalInterest += calc.interestTillDate;
                receivablesTotalAmount += calc.total;
            });

            // Calculate payables totals
            let payablesTotalPrincipal = 0;
            let payablesTotalInterest = 0;
            let payablesTotalAmount = 0;

            payables.forEach(entry => {
                let calc;
                if (entry.durationType === 'date' || entry.durationType === 'fromstart') {
                    calc = calculateCompoundInterest(entry.principal, entry.rate, entry.startDate, entry.endDate);
                } else {
                    calc = calculateCompoundInterest(entry.principal, entry.rate, entry.startDate, null, entry.years, entry.months, entry.days);
                }
                payablesTotalPrincipal += entry.principal;
                payablesTotalInterest += calc.interestTillDate;
                payablesTotalAmount += calc.total;
            });

            // Update dashboard display
            document.getElementById('dashboard-receivables-principal').textContent = `‚Çπ${receivablesTotalPrincipal.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;
            document.getElementById('dashboard-receivables-interest').textContent = `‚Çπ${receivablesTotalInterest.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;
            document.getElementById('dashboard-receivables-total').textContent = `‚Çπ${receivablesTotalAmount.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;

            document.getElementById('dashboard-payables-principal').textContent = `‚Çπ${payablesTotalPrincipal.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;
            document.getElementById('dashboard-payables-interest').textContent = `‚Çπ${payablesTotalInterest.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;
            document.getElementById('dashboard-payables-total').textContent = `‚Çπ${payablesTotalAmount.toLocaleString('en-IN', {maximumFractionDigits: 2})}`;

            // Calculate net position
            const netPosition = receivablesTotalAmount - payablesTotalAmount;
            const netPositionElement = document.getElementById('net-position');
            const netPositionText = document.getElementById('net-position-text');

            netPositionElement.textContent = `‚Çπ${Math.abs(netPosition).toLocaleString('en-IN', {maximumFractionDigits: 2})}`;

            if (netPosition > 0) {
                netPositionElement.className = 'text-3xl font-bold mb-2 text-green-600';
                netPositionText.textContent = 'Net Amount to Receive';
            } else if (netPosition < 0) {
                netPositionElement.className = 'text-3xl font-bold mb-2 text-red-600';
                netPositionText.textContent = 'Net Amount to Pay';
            } else {
                netPositionElement.className = 'text-3xl font-bold mb-2 text-gray-600';
                netPositionText.textContent = 'Balanced Position';
            }
        }

        // Initialize with today's date and show receivables section
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('receivable-start-date').value = today;
            document.getElementById('payable-start-date').value = today;
            showSection('receivables'); // Ensure receivables section is shown on load
        });
    </script>
</body>
</html>
